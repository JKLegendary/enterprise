<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>POS Layer 1 (No Firebase)</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    body { margin: 0; background: #0b0c10; color: #eaf0ff; }
    .topbar { display:flex; justify-content:space-between; align-items:center; padding: 12px 14px; background:#11131a; position:sticky; top:0; z-index:10; }
    .brand { font-weight:800; }
    .nav { display:flex; gap:8px; }
    .navbtn { background:#1b1f2b; color:#eaf0ff; border:1px solid #2a3042; padding:10px 12px; border-radius:10px; font-weight:700; }
    .navbtn.active { outline:2px solid #7aa2ff; }

    .app { padding:12px; padding-bottom:56px; }
    .view { min-height: calc(100vh - 60px); }
    .hidden { display:none !important; }

    .split { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .pane { background:#11131a; border:1px solid #20243a; border-radius:14px; padding:12px; }
    .pane.wide { max-width: 820px; margin:0 auto; }
    .pane-head { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }

    .grid { display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:10px; overflow:auto; max-height:72vh; padding-right:4px; }
    .list { display:flex; flex-direction:column; gap:10px; overflow:auto; max-height:60vh; padding-right:4px; }

    .card { background:#0d0f15; border:1px solid #22263a; border-radius:12px; padding:10px; }
    .row { display:flex; justify-content:space-between; gap:10px; align-items:center; }
    .row.big { font-size: 20px; }
    .tiny { opacity:.7; font-size:12px; }

    .primary { background:#7aa2ff; color:#081022; border:none; padding:12px; border-radius:12px; font-weight:900; width:100%; }
    .ghost { background: transparent; color:#eaf0ff; border:1px solid #2a3042; padding:10px 12px; border-radius:12px; font-weight:800; }
    button { touch-action: manipulation; }
    input { width:100%; box-sizing:border-box; padding:12px; border-radius:12px; border:1px solid #2a3042; background:#0b0c10; color:#eaf0ff; font-size:16px; }

    .totals { margin-top:10px; display:flex; flex-direction:column; gap:10px; }
    .subpanel { margin-top:14px; }

    /* Modal (items editor) */
    .modal { position:fixed; inset:0; background: rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; padding:14px; z-index:50; }
    .modal-card { width:min(820px, 100%); background:#11131a; border:1px solid #20243a; border-radius:14px; padding:14px; }
    .actions { display:flex; gap:10px; margin-top:12px; }
    .actions button { width:50%; }
    .actions.single button { width:100%; }
    hr { border:none; border-top:1px solid #20243a; margin:14px 0; }

    /* Pay page */
    .paybox { display:flex; flex-direction:column; gap:12px; max-width:520px; margin:0 auto; }
    .label { display:block; margin-top:10px; margin-bottom:6px; opacity:.85; }
    .err { color:#ff8a8a; min-height:18px; }

    /* Status */
    .statusbar { position:fixed; left:0; right:0; bottom:0; padding:8px 10px; font:14px system-ui; background:#11131a; border-top:1px solid #20243a; z-index:9999; }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">POS Layer 1 (No Sync)</div>
    <nav class="nav">
      <button class="navbtn" data-view="cashier">Cashier</button>
      <button class="navbtn" data-view="cook">Cook</button>
      <button class="navbtn" data-view="history">History</button>
      <button class="navbtn" data-view="completion">Completion</button>
    </nav>
  </header>

  <main class="app">
    <!-- CASHIER -->
    <section id="view-cashier" class="view">
      <div id="cashierMain">
        <div class="split">
          <div class="pane">
            <div class="pane-head">
              <h2>Menu</h2>
              <button id="editItemsBtn" class="ghost">Items ✏️</button>
            </div>
            <div id="itemsGrid" class="grid"></div>
          </div>

          <div class="pane">
            <div class="pane-head">
              <h2>Cart</h2>
              <button id="clearCartBtn" class="ghost">Clear</button>
            </div>

            <div id="cartList" class="list"></div>

            <div class="totals">
              <div class="row"><span>Total</span><strong id="cartTotal">£0.00</strong></div>
              <button id="payBtn" class="primary">Pay</button>
            </div>

            <div class="subpanel">
              <h3>Ready orders</h3>
              <div id="cashierReadyList" class="list"></div>
            </div>
          </div>
        </div>
      </div>

      <div id="cashierPay" class="hidden">
        <div class="pane wide">
          <div class="pane-head">
            <h2>Payment</h2>
            <button id="backToCashierBtn" class="ghost">Back</button>
          </div>

          <div class="paybox">
            <div class="row big"><span>Amount due</span><strong id="dueAmt">£0.00</strong></div>

            <label class="label">Amount given</label>
            <input id="givenInput" type="number" inputmode="decimal" placeholder="0.00" />

            <div class="row big"><span>Change</span><strong id="changeAmt">£0.00</strong></div>

            <div class="actions">
              <button id="cancelPayBtn" class="ghost">Cancel</button>
              <button id="completePayBtn" class="primary">Complete</button>
            </div>

            <p id="payErr" class="err"></p>
          </div>
        </div>
      </div>

      <!-- Items modal -->
      <div id="itemsModal" class="modal">
        <div class="modal-card">
          <div class="pane-head">
            <h2>Items</h2>
            <button id="closeItemsBtn" class="ghost">Close</button>
          </div>

          <div class="row">
            <input id="newItemName" placeholder="Name (e.g., Burger)" />
            <input id="newItemPrice" type="number" inputmode="decimal" placeholder="Price" />
          </div>
          <input id="newItemNotes" placeholder="Notes (optional)" />

          <div class="actions single">
            <button id="addItemBtn" class="primary">Add item</button>
          </div>

          <hr />
          <div id="itemsAdminList" class="list"></div>
        </div>
      </div>
    </section>

    <!-- COOK -->
    <section id="view-cook" class="view hidden">
      <div class="split">
        <div class="pane">
          <div class="pane-head"><h2>Orders (Cooking)</h2></div>
          <div id="cookOrders" class="list"></div>
        </div>
        <div class="pane">
          <div class="pane-head"><h2>How to use</h2></div>
          <p>Tap an order to expand inline. Tap ✅ to mark READY.</p>
        </div>
      </div>
    </section>

    <!-- HISTORY -->
    <section id="view-history" class="view hidden">
      <div class="pane">
        <div class="pane-head"><h2>Order History</h2></div>
        <div id="historyList" class="list"></div>
      </div>
    </section>

    <!-- COMPLETION -->
    <section id="view-completion" class="view hidden">
      <div class="split">
        <div class="pane">
          <div class="pane-head"><h2>Ready orders</h2></div>
          <div id="readyOrders" class="list"></div>
        </div>
        <div class="pane">
          <div class="pane-head"><h2>Soundboard</h2></div>
          <div id="soundboard" class="grid"></div>
          <p class="tiny">Tap a number to announce it.</p>
        </div>
      </div>
    </section>
  </main>

  <div class="statusbar">Status: <span id="statusText">Loading…</span></div>

<script>
const el = (id) => document.getElementById(id);
const £ = (n) => `£${(Math.round((n + Number.EPSILON) * 100) / 100).toFixed(2)}`;
const setStatus = (t) => el("statusText").textContent = t;

function show(id){ el(id).classList.remove("hidden"); }
function hide(id){ el(id).classList.add("hidden"); }
function showModal(id){ el(id).style.display = "flex"; }
function hideModal(id){ el(id).style.display = "none"; }

let menuItems = [
  { id:"demo1", name:"Burger", price:5.00, notes:"" },
  { id:"demo2", name:"Chips", price:2.50, notes:"" },
  { id:"demo3", name:"Drink", price:1.50, notes:"" },
];

let cart = new Map(); // itemId -> {item, qty}
let nextOrderNumber = 1;

let orders = []; // {id, number, status, lines, total, paid, change, createdAt, readyAt, pickedUpAt}

function setView(view){
  document.querySelectorAll(".navbtn").forEach(b=>{
    b.classList.toggle("active", b.dataset.view === view);
  });
  ["cashier","cook","history","completion"].forEach(v=>{
    el(`view-${v}`).classList.toggle("hidden", v !== view);
  });
}

function renderMenu(){
  const grid = el("itemsGrid");
  grid.innerHTML = "";
  for (const it of menuItems){
    const btn = document.createElement("button");
    btn.className = "card";
    btn.innerHTML = `<div style="font-weight:900;font-size:18px;">${it.name}</div>
                     <div style="opacity:.8;margin-top:6px;">${£(it.price)}</div>`;
    btn.onclick = () => addToCart(it.id);
    grid.appendChild(btn);
  }
}

function renderItemsAdmin(){
  const list = el("itemsAdminList");
  list.innerHTML = "";
  for (const it of menuItems){
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div class="row">
        <div>
          <div style="font-weight:900">${it.name} <span style="opacity:.7">(${£(it.price)})</span></div>
          <div class="tiny">${it.notes || ""}</div>
        </div>
        <button class="ghost" style="width:auto;">Delete</button>
      </div>
    `;
    card.querySelector("button").onclick = () => {
      if (!confirm(`Delete "${it.name}"?`)) return;
      menuItems = menuItems.filter(x => x.id !== it.id);
      cart.delete(it.id);
      renderMenu();
      renderItemsAdmin();
      renderCart();
    };
    list.appendChild(card);
  }
}

function addToCart(itemId){
  const it = menuItems.find(x=>x.id===itemId);
  if (!it) return;
  const existing = cart.get(itemId);
  if (existing) existing.qty += 1;
  else cart.set(itemId, { item: it, qty: 1 });
  renderCart();
}

function cartTotal(){
  let total = 0;
  for (const { item, qty } of cart.values()) total += item.price * qty;
  return total;
}

function renderCart(){
  const list = el("cartList");
  list.innerHTML = "";
  for (const [itemId, entry] of cart.entries()){
    const { item, qty } = entry;
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div class="row">
        <div>
          <div style="font-weight:900">${item.name}</div>
          <div class="tiny">${£(item.price)} each</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center;">
          <button class="ghost" style="padding:8px 10px;">−</button>
          <strong style="min-width:28px;text-align:center;">${qty}</strong>
          <button class="ghost" style="padding:8px 10px;">+</button>
        </div>
      </div>
      <div class="row" style="margin-top:8px;">
        <span class="tiny">Line total</span>
        <strong>${£(item.price * qty)}</strong>
      </div>
    `;
    const [minusBtn, plusBtn] = card.querySelectorAll("button");
    minusBtn.onclick = () => {
      const e = cart.get(itemId);
      if (!e) return;
      e.qty -= 1;
      if (e.qty <= 0) cart.delete(itemId);
      renderCart();
    };
    plusBtn.onclick = () => {
      const e = cart.get(itemId);
      if (!e) return;
      e.qty += 1;
      renderCart();
    };
    list.appendChild(card);
  }
  el("cartTotal").textContent = £(cartTotal());
}

function openPayView(){
  if (cart.size === 0) return;
  el("payErr").textContent = "";
  el("givenInput").value = "";
  el("dueAmt").textContent = £(cartTotal());
  el("changeAmt").textContent = £(0);
  hide("cashierMain");
  show("cashierPay");
}
function closePayView(){ show("cashierMain"); hide("cashierPay"); }
function calcChange(){
  const due = cartTotal();
  const given = Number(el("givenInput").value);
  const change = Number.isFinite(given) ? (given - due) : 0;
  el("changeAmt").textContent = £(Math.max(0, change));
}

function confirmPayment(){
  el("payErr").textContent = "";
  const due = cartTotal();
  const given = Number(el("givenInput").value);
  if (!Number.isFinite(given) || given < due) {
    el("payErr").textContent = "Amount given must be at least the amount due.";
    return;
  }

  const lines = [];
  for (const { item, qty } of cart.values()){
    lines.push({ itemId: item.id, name: item.name, price: item.price, qty, notes: item.notes || "" });
  }

  if (!confirm("Complete payment and send order to cook?")) return;

  const order = {
    id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random(),
    number: nextOrderNumber++,
    status: "COOKING",
    lines,
    total: due,
    paid: given,
    change: given - due,
    createdAt: Date.now(),
    readyAt: null,
    pickedUpAt: null,
  };
  orders.push(order);

  cart.clear();
  renderCart();
  closePayView();

  renderCook();
  renderReadyEverywhere();
  renderHistory();

  alert(`Order #${order.number} sent ✅`);
}

function renderCook(){
  const cooking = orders.filter(o => o.status === "COOKING").sort((a,b)=>b.createdAt-a.createdAt);
  const list = el("cookOrders");
  list.innerHTML = "";

  for (const o of cooking){
    const card = document.createElement("div");
    card.className = "card";
    const linesHtml = o.lines.map(l => `<div class="row"><span>${l.qty}× ${l.name}</span><span>${£(l.price*l.qty)}</span></div>`).join("");
    card.innerHTML = `
      <div class="row">
        <div style="font-weight:900;font-size:18px;">Order #${o.number}</div>
        <button class="primary" style="width:auto;padding:10px 12px;">✅</button>
      </div>
      <div class="tiny" style="margin-top:6px;opacity:.85">Tap card to expand</div>
      <div class="details hidden" style="margin-top:10px;display:flex;flex-direction:column;gap:8px;">
        ${linesHtml}
        <div class="row" style="margin-top:6px;"><strong>Total</strong><strong>${£(o.total)}</strong></div>
      </div>
    `;

    const details = card.querySelector(".details");
    card.onclick = (ev) => {
      if (ev.target.tagName === "BUTTON") return;
      details.classList.toggle("hidden");
    };

    card.querySelector("button").onclick = () => {
      if (!confirm(`Mark Order #${o.number} as READY?`)) return;
      o.status = "READY";
      o.readyAt = Date.now();
      renderCook();
      renderReadyEverywhere();
      renderHistory();
    };

    list.appendChild(card);
  }
}

function speak(text){
  if (!("speechSynthesis" in window)) { alert("Speech not supported."); return; }
  const u = new SpeechSynthesisUtterance(text);
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(u);
}

function renderReadyEverywhere(){
  const ready = orders.filter(o=>o.status==="READY").sort((a,b)=>(b.readyAt||0)-(a.readyAt||0));

  // Cashier ready list
  const cashierList = el("cashierReadyList");
  cashierList.innerHTML = "";
  for (const o of ready){
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `<div class="row"><strong>Order #${o.number}</strong><span class="tiny">READY</span></div>`;
    cashierList.appendChild(card);
  }

  // Completion left list
  const readyList = el("readyOrders");
  readyList.innerHTML = "";
  for (const o of ready){
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div class="row">
        <div>
          <div style="font-weight:900;font-size:18px;">Order #${o.number}</div>
          <div class="tiny">${o.lines.length} line(s)</div>
        </div>
        <button class="ghost" style="width:auto;">Taken</button>
      </div>
    `;
    card.querySelector("button").onclick = () => {
      if (!confirm(`Customer collected Order #${o.number}?`)) return;
      o.status = "PICKED_UP";
      o.pickedUpAt = Date.now();
      renderReadyEverywhere();
      renderHistory();
    };
    readyList.appendChild(card);
  }

  // Soundboard
  const board = el("soundboard");
  board.innerHTML = "";
  for (const o of ready){
    const btn = document.createElement("button");
    btn.className = "card";
    btn.innerHTML = `<div style="font-weight:900;font-size:22px;">#${o.number}</div><div class="tiny">Tap to announce</div>`;
    btn.onclick = () => speak(`Order ${o.number} is ready`);
    board.appendChild(btn);
  }
}

function renderHistory(){
  const list = el("historyList");
  list.innerHTML = "";
  const sorted = [...orders].sort((a,b)=>b.createdAt-a.createdAt);

  for (const o of sorted){
    const card = document.createElement("div");
    card.className = "card";
    const linesHtml = o.lines.map(l => `<div class="row"><span>${l.qty}× ${l.name}</span><span>${£(l.price*l.qty)}</span></div>`).join("");
    card.innerHTML = `
      <div class="row">
        <div>
          <div style="font-weight:900">Order #${o.number} <span class="tiny">(${o.status})</span></div>
          <div class="tiny">Total ${£(o.total)} • Paid ${£(o.paid)} • Change ${£(o.change)}</div>
        </div>
        <button class="ghost" style="width:auto;">Details</button>
      </div>
      <div class="details hidden" style="margin-top:10px;display:flex;flex-direction:column;gap:8px;">
        ${linesHtml}
      </div>
    `;
    const details = card.querySelector(".details");
    card.querySelector("button").onclick = () => details.classList.toggle("hidden");
    list.appendChild(card);
  }
}

window.addEventListener("DOMContentLoaded", () => {
  // Nav
  document.querySelectorAll(".navbtn").forEach(b=>{
    b.onclick = () => setView(b.dataset.view);
  });
  setView("cashier");

  // Cashier UI
  el("clearCartBtn").onclick = () => { cart.clear(); renderCart(); };
  el("payBtn").onclick = openPayView;
  el("backToCashierBtn").onclick = closePayView;
  el("cancelPayBtn").onclick = closePayView;
  el("completePayBtn").onclick = confirmPayment;
  el("givenInput").oninput = calcChange;

  // Items editor
  el("editItemsBtn").onclick = () => { showModal("itemsModal"); renderItemsAdmin(); };
  el("closeItemsBtn").onclick = () => hideModal("itemsModal");
  el("itemsModal").onclick = (e) => { if (e.target === el("itemsModal")) hideModal("itemsModal"); };
  el("addItemBtn").onclick = () => {
    const name = el("newItemName").value.trim();
    const price = Number(el("newItemPrice").value);
    const notes = el("newItemNotes").value.trim();
    if (!name || !Number.isFinite(price)) return;

    menuItems.push({ id: String(Date.now()) + Math.random(), name, price, notes });
    el("newItemName").value="";
    el("newItemPrice").value="";
    el("newItemNotes").value="";
    renderMenu();
    renderItemsAdmin();
  };

  // Initial renders
  renderMenu();
  renderCart();
  renderCook();
  renderReadyEverywhere();
  renderHistory();

  setStatus("Layer 1 OK ✅ (no sync yet)");
});
</script>
</body>
</html>
