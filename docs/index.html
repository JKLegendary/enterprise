<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Stall POS</title>

  <style>
    body { margin:0; font-family:system-ui; background:#0b0c10; color:#eaf0ff; }
    .topbar { display:flex; justify-content:space-between; padding:12px; background:#11131a; }
    .nav button { margin-left:6px; }
    .hidden { display:none; }
    .view { padding:12px; }
    .split { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .pane { background:#11131a; padding:12px; border-radius:12px; }
    .grid { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; }
    .list { display:flex; flex-direction:column; gap:8px; }
    .card { background:#1b1f2b; padding:10px; border-radius:10px; }
    button { padding:10px; border:none; border-radius:8px; cursor:pointer; }
    .primary { background:#7aa2ff; color:#000; font-weight:bold; }
    .ghost { background:#2a3042; color:white; }
    .modal { position:fixed; inset:0; background:rgba(0,0,0,.7); display:none; align-items:center; justify-content:center; }
    .modal-card { background:#11131a; padding:20px; border-radius:12px; width:400px; }
    input { padding:8px; width:100%; margin:5px 0; border-radius:6px; border:none; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>
</head>
<body>

<header class="topbar">
  <div><strong>Stall POS</strong></div>
  <div class="nav">
    <button onclick="showView('cashier')">Cashier</button>
    <button onclick="showView('cook')">Cook</button>
    <button onclick="showView('completion')">Completion</button>
    <button onclick="showView('history')">History</button>
  </div>
</header>

<main>

<section id="cashier" class="view">
  <div class="split">
    <div class="pane">
      <h3>Menu <button class="ghost" onclick="openItems()">✏️</button></h3>
      <div id="items" class="grid"></div>
    </div>

    <div class="pane">
      <h3>Cart</h3>
      <div id="cart" class="list"></div>
      <h3>Total: £<span id="total">0.00</span></h3>
      <button class="primary" onclick="openPay()">Pay</button>
    </div>
  </div>
</section>

<section id="cook" class="view hidden">
  <h2>Cook</h2>
  <div id="cookOrders"></div>
</section>

<section id="completion" class="view hidden">
  <h2>Completion</h2>
</section>

<section id="history" class="view hidden">
  <h2>History</h2>
</section>

</main>

<!-- ITEMS MODAL -->
<div id="itemsModal" class="modal">
  <div class="modal-card">
    <h3>Add Item</h3>
    <input id="itemName" placeholder="Name"/>
    <input id="itemPrice" type="number" placeholder="Price"/>
    <button class="primary" onclick="addItem()">Add</button>
    <button class="ghost" onclick="closeItems()">Close</button>
  </div>
</div>

<!-- PAY MODAL -->
<div id="payModal" class="modal">
  <div class="modal-card">
    <h3>Payment</h3>
    <p>Amount Due: £<span id="dueAmount">0.00</span></p>
    <input id="amountGiven" type="number" placeholder="Amount given" oninput="calculateChange()"/>
    <p>Change: £<span id="change">0.00</span></p>
    <button class="primary" onclick="completeOrder()">Complete</button>
    <button class="ghost" onclick="closePay()">Cancel</button>
  </div>
</div>

<script>
/* Firebase Config */
firebase.initializeApp({
  apiKey: "AIzaSyARBfapCjXLkhlmuTKT9lJRbLLAc6u0jU0",
  authDomain: "enterprise-d157a.firebaseapp.com",
  projectId: "enterprise-d157a"
});
const db = firebase.firestore();

/* State */
let items = [];
let cart = [];

/* View switching */
function showView(view){
  ["cashier","cook","completion","history"].forEach(v=>{
    document.getElementById(v).classList.add("hidden");
  });
  document.getElementById(view).classList.remove("hidden");
}

/* Items */
function openItems(){ document.getElementById("itemsModal").style.display="flex"; }
function closeItems(){ document.getElementById("itemsModal").style.display="none"; }

async function addItem(){
  const name=document.getElementById("itemName").value;
  const price=Number(document.getElementById("itemPrice").value);
  if(!name||!price) return;

  await db.collection("items").add({name,price,createdAt:Date.now()});
  document.getElementById("itemName").value="";
  document.getElementById("itemPrice").value="";
  closeItems();
}

/* Live items */
db.collection("items").orderBy("createdAt").onSnapshot(snapshot=>{
  items=[];
  document.getElementById("items").innerHTML="";
  snapshot.forEach(doc=>{
    const item=doc.data();
    items.push({id:doc.id,...item});
    const btn=document.createElement("button");
    btn.innerText=item.name+" £"+item.price;
    btn.onclick=()=>addToCart(doc.id);
    document.getElementById("items").appendChild(btn);
  });
});

/* Cart */
function addToCart(id){
  const item=items.find(i=>i.id===id);
  cart.push(item);
  renderCart();
}

function renderCart(){
  const c=document.getElementById("cart");
  c.innerHTML="";
  let total=0;
  cart.forEach(item=>{
    total+=item.price;
    const div=document.createElement("div");
    div.className="card";
    div.innerText=item.name+" £"+item.price;
    c.appendChild(div);
  });
  document.getElementById("total").innerText=total.toFixed(2);
}

/* Pay */
function openPay(){
  document.getElementById("dueAmount").innerText=document.getElementById("total").innerText;
  document.getElementById("payModal").style.display="flex";
}
function closePay(){ document.getElementById("payModal").style.display="none"; }

function calculateChange(){
  const due=Number(document.getElementById("dueAmount").innerText);
  const given=Number(document.getElementById("amountGiven").value);
  document.getElementById("change").innerText=(given-due).toFixed(2);
}

function completeOrder(){
  cart=[];
  renderCart();
  closePay();
  alert("Order completed");
}
</script>

</body>
</html>